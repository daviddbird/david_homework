---
title: "R Notebook"
output: html_notebook
---


Use the stock prices data from the CodeClanData: IBM_stock_price and JNJ_stock_price
```{r}
library(tidyverse)
library(CodeClanData)
library(lubridate)
```

```{r}
IBM_stock_price
```
```{r}
JNJ_stock_price
```

Your JNJ data is in wide format. Reshape it so it is in long format. Create two columns: one called date and one called jnj_open (as it is open stock prices). Save it in a new tibble called JNJ_stock_price_gathered.

```{r}
JNJ_stock_price_gathered <- JNJ_stock_price %>%
gather(date, jnj_open)
JNJ_stock_price_gathered
```

Your IBM data has a variable called agents in it, which contains the initials of the two staff working. Separate out this column into two: agent1 and agent2. Save the output in a new tibble called IBM_agents.
```{r}
IBM_stock_price
```

```{r}
IBM_agents <- IBM_stock_price %>%
  separate(Agents, c("agent1", "agent2"), sep = "\\/")
IBM_agents
```

Use the unite function to unite the Agent ID columns (ID1,ID2) with the agent initials. Use a colon as a separator. Hint: you might need to use a pipe to do 2 unite functions. Select only the agent variables and save it in a tibble called IBM_agent_data.

```{r}
IBM_agent_data <- IBM_agents %>%
  unite(ID1_agent, c("ID1", "agent1"), sep = ":") %>%
  unite(ID2_agent, c("ID2", "agent2"), sep = ":")

IBM_agent_data
```

5. Your JNJ data only has data for open stock. Therefore first thing to do is create a new tibble called IBM_data, which selects only the date and the open stock data from the IBM_stock_data tibble. Once you have that, use a full join to join the IBM_data and JNJ_data tibbles. Save it in a new tibble called open_stock_data.

```{r}
IBM_data <- IBM_agent_data %>%
  select(date, open)

IBM_data
```

```{r}
open_stock_data <- IBM_data %>%
  select(date, open) %>%
  full_join(JNJ_stock_price_gathered)

open_stock_data
```
6. Write a for loop which calculates the mean of each variable in the open_stock dataset. Save the output in a vector called stock_mean_data. Hint: remember you’ll have to create a vector first, before your loop starts. You’ll need to watch your indexing, as there isn’t any point calculating a mean for the date variable.

```{r}
stock_mean_data <- vector("double", length(open_stock_data[, 2:3]))

stock_mean_data

for (i in 2:3) {
  
  stock_mean_data[i-1] <- mean(open_stock_data[[i]])
  
}
stock_mean_data
# Example that could be used using lapply
#lapply(filter(open_stock_data, -c("date")), mean)


# for (i in seq_along(open_stock_data[, 2:3])) {
#   
#   stock_mean_data[i] <- mean(open_stock_data[[i]])
# }
```


7. Now do the same calculation with the appropriate map function.
```{r}
map_dbl(open_stock_data[, 2:3],mean)
```

**Extensions**
1. Write a loop which calculates the length of each variable in open_stock
```{r}
open_stock_data
```

```{r}
for (item in open_stock_data){
  print(nchar(item))
}
```
2.Write a loop which prints the type of each variable in open_stock

```{r}
for (item in open_stock_data){
  print(class(item))
}
```

3.Use the map function to turn your date column in stock_data into datetimes.

```{r}
class(open_stock_data)
typeof(open_stock_data)
```


```{r}
map_dbl(open_stock_data$date, as_datetime)
map(open_stock_data$date, dmy)
```


```{r}
open_stock_data
```

4. Use the map function to calculate the median of the stock price.
```{r}
map_dbl(open_stock_data[, 2:3],median)
```

5. Calculate summary stats for all the numeric variables.
```{r}
summary(open_stock_data$open)
```

```{r}
summary(open_stock_data$jnj_open)
```

